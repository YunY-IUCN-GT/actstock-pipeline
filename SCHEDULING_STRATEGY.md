````markdown
# ETF ë°ì´í„° ìˆ˜ì§‘ ìŠ¤ì¼€ì¤„ë§ ì „ëµ

## ê°œìš”
ì´ ë¬¸ì„œëŠ” yfinance API Rate Limitì„ í”¼í•˜ë©´ì„œ ì¼ë³„ ë° ì›”ê°„ ë°ì´í„°ë¥¼ í¬ê´„ì ìœ¼ë¡œ í™•ë³´í•˜ê¸° ìœ„í•´ ì„¤ê³„ëœ ETF ë°ì´í„°ì˜ **ìŠ¤ì¼€ì¤„ ë°°ì¹˜ ìˆ˜ì§‘** ì „ëµì„ ì„¤ëª…í•©ë‹ˆë‹¤.

## í•µì‹¬ ì›ì¹™

### ğŸš« ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¬ë° ì—†ìŒ
- **ETF ë°ì´í„°ëŠ” ì§€ì†ì ìœ¼ë¡œ ìˆ˜ì§‘ë˜ì§€ ì•ŠìŠµë‹ˆë‹¤**
- **ìˆ˜ì§‘ì€ í•˜ë£¨ 4íšŒ (ì›”-ê¸ˆ) + ì›” 1íšŒ (ë§ˆì§€ë§‰ í† )ì— ë°œìƒ**
- ê° ìˆ˜ì§‘ì€ ì‹¤ì‹œê°„ ìŠ¤íŠ¸ë¦¼ì´ ì•„ë‹Œ **ìŠ¤ì¼€ì¤„ ë°°ì¹˜ ì‘ì—…**

### ğŸ“… ìŠ¤ì¼€ì¤„ ë°°ì¹˜ ìˆ˜ì§‘ (5-Stage Pipeline)
```
ì¼ë³„: 5-stage workflow (ì›”-ê¸ˆ)
  â”œâ”€ 09:00 UTC: Stage 1 - Benchmark ETF OHLC (6ê°œ)
  â”œâ”€ 10:00 UTC: Stage 2 - Sector ETF OHLC (11ê°œ)
  â”œâ”€ 11:00 UTC: Stage 3 - Trending ETF ì‹ë³„ (Spark)
  â”œâ”€ 12:00 UTC: Stage 4 - Conditional Holdings (íŠ¸ë Œë”© ETFë§Œ)
  â””â”€ 13:00 UTC: Stage 5 - Portfolio Allocation (Spark)

íŠ¹ì§•:
  â€¢ íŠ¸ë Œë”© ETFë§Œ íƒ€ê²ŸíŒ… â†’ API í˜¸ì¶œ 50-70% ê°ì†Œ
  â€¢ 1ì£¼ per íŠ¸ë Œë”© ETF ì„ ì • (absolute best performer)
  â€¢ Weight = performance Ã— inverse market cap
```

### ğŸ”„ ë‘ ê°€ì§€ ìˆ˜ì§‘ ê²½ë¡œ (ë™ì¼ ìŠ¤ì¼€ì¤„)

**í‘œì¤€ ê²½ë¡œ: ìŠ¤ì¼€ì¤„ Kafka íŒŒì´í”„ë¼ì¸**
```
Airflow DAG â†’ Kafka Producer â†’ Kafka Topic â†’ Consumer â†’ PostgreSQL
```
- ìˆ˜ì§‘ ì´ë ¥ ë¡œê·¸ ë³´ê´€
- ì¬ì²˜ë¦¬ ê°€ëŠ¥
- ëª¨ë‹ˆí„°ë§ì— ìœ ë¦¬
- **ëª¨ë“  DAGì—ì„œ ì‚¬ìš©í•˜ëŠ” í‘œì¤€ ë°©ì‹**

**âš ï¸ ì¤‘ìš”**: KafkaëŠ” **ìŠ¤ì¼€ì¤„ ë°°ì¹˜**ë¡œ ì‹¤í–‰ (ì‹¤ì‹œê°„ ì•„ë‹˜)

## Rate Limit ë¬¸ì œ
- **yfinance ë¬´ë£Œ í‹°ì–´**: ë¶„ë‹¹ ìš”ì²­ ìˆ˜ ì œí•œ
- **ì‹œì¥ ê°œì¥ì¼**: API íŠ¸ë˜í”½ ì¦ê°€ë¡œ Rate Limit ìœ„í—˜ ì¦ê°€
- **ëŒ€ëŸ‰ ìˆ˜ì§‘**: ì—¬ëŸ¬ ETFë¥¼ ìˆœì°¨ì ìœ¼ë¡œ ìˆ˜ì§‘í•˜ë©´ 429 ì—ëŸ¬ ë°œìƒ ê°€ëŠ¥
- **í•´ê²°ì±…**: ê·¸ë£¹ ê°„ ì‹œê°„ ë¶„ì‚°ì„ í†µí•œ ë¶„ì‚° ìŠ¤ì¼€ì¤„ë§

## ìŠ¤ì¼€ì¤„ë§ ì•„í‚¤í…ì²˜

### ì¼ë³„ ìˆ˜ì§‘ (í‰ì¼ë§Œ: ì›”-ê¸ˆ)

```
09:00 UTC â†’ Stage 1: Benchmark ETF OHLC (6 ETFs)
              â†“ (1ì‹œê°„ ë²„í¼)
10:00 UTC â†’ Stage 2: Sector ETF OHLC (11 ETFs)
              â†“ (1ì‹œê°„ ë²„í¼)
11:00 UTC â†’ Stage 3: Trending ETF Identification (Spark vs SPY)
              â†“ (1ì‹œê°„ ë²„í¼)
12:00 UTC â†’ Stage 4: Conditional Holdings (íŠ¸ë Œë”© ETFì˜ top 5ë§Œ)
              â†“ (1ì‹œê°„ ë²„í¼)
13:00 UTC â†’ Stage 5: Portfolio Allocation (1ì£¼ per íŠ¸ë Œë”© ETF)
```

### ì›”ê°„ ìˆ˜ì§‘ (ë§ˆì§€ë§‰ ì£¼ë§)
```
ë§ˆì§€ë§‰ í† ìš”ì¼ @ 08:00 UTC â†’ ì „ì²´ ETF + ì „ì²´ Top Holdings ë¶„ì„ (ìŠ¤ì¼€ì¤„ ë°°ì¹˜)
```

## ê·¸ë£¹ ìƒì„¸

### ê·¸ë£¹ 1: ë²¤ì¹˜ë§ˆí¬ ETF ë°ì´í„° ìˆ˜ì§‘
**DAG**: `daily_benchmark_etf_collection_dag.py`  
**ìŠ¤ì¼€ì¤„**: `0 9 * * 1-5` (ì›”-ê¸ˆ ì˜¤ì „ 9ì‹œ UTC)  
**ì‹¤í–‰**: **í•˜ë£¨ 1íšŒ** (ìŠ¤ì¼€ì¤„ ë°°ì¹˜, ìŠ¤íŠ¸ë¦¬ë° ì•„ë‹˜)  
**í‹°ì»¤**: SPY, QQQ, IWM, EWY, DIA, SCHD (6ê°œ ETF)  
**Rate Limit**: í‹°ì»¤ ê°„ 5ì´ˆ  
**ì´ ì†Œìš” ì‹œê°„**: ~30ì´ˆ

**ìˆ˜í–‰ ì‘ì—…**:
- 6ê°œ ë²¤ì¹˜ë§ˆí¬ ETFì˜ OHLC ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
- `collected_daily_etf_ohlc` í…Œì´ë¸”ì— ì €ì¥
- í‰ì¼ í™•ì¸ìœ¼ë¡œ ì£¼ë§ ì‹¤í–‰ ë°©ì§€
- **1íšŒ ì‹¤í–‰ í›„ ì •ì§€** (ì§€ì† ì‹¤í–‰ ì•„ë‹˜)

### ê·¸ë£¹ 2: ì„¹í„° ETF ë°ì´í„° ìˆ˜ì§‘
**DAG**: `daily_sector_etf_collection_dag.py`  
**ìŠ¤ì¼€ì¤„**: `0 10 * * 1-5` (ì›”-ê¸ˆ ì˜¤ì „ 10ì‹œ UTC)  
**ì‹¤í–‰**: **í•˜ë£¨ 1íšŒ** (ìŠ¤ì¼€ì¤„ ë°°ì¹˜, ìŠ¤íŠ¸ë¦¬ë° ì•„ë‹˜)  
**í‹°ì»¤**: XLK, XLV, XLF, XLY, XLC, XLI, XLP, XLE, XLU, XLRE, XLB (11ê°œ ETF)  
**Rate Limit**: í‹°ì»¤ ê°„ 5ì´ˆ  
**ì´ ì†Œìš” ì‹œê°„**: ~55ì´ˆ

**ìˆ˜í–‰ ì‘ì—…**:
- 11ê°œ ì„¹í„° ETFì˜ OHLC ë°ì´í„° ê°€ì ¸ì˜¤ê¸°
- `collected_daily_etf_ohlc` í…Œì´ë¸”ì— ì €ì¥
- ë¶€í•˜ ë¶„ì‚°ì„ ìœ„í•´ ê·¸ë£¹ 1 í›„ 1ì‹œê°„ ë’¤ ì‹¤í–‰
- **1íšŒ ì‹¤í–‰ í›„ ì •ì§€** (ì§€ì† ì‹¤í–‰ ì•„ë‹˜)

### ê·¸ë£¹ 3: ë²¤ì¹˜ë§ˆí¬ Top Holdings ë¶„ì„
**DAG**: `daily_benchmark_top_holdings_dag.py`  
**ìŠ¤ì¼€ì¤„**: `0 11 * * 1-5` (ì›”-ê¸ˆ ì˜¤ì „ 11ì‹œ UTC)  
**ì‹¤í–‰**: **í•˜ë£¨ 1íšŒ** (ìŠ¤ì¼€ì¤„ ë°°ì¹˜)  
**ì¢…ì†ì„±**: ê·¸ë£¹ 1 ë°ì´í„° í•„ìš” (ìµœì†Œ 4/6ê°œ ETF)  
**ì²˜ë¦¬**: `ETF_TYPE_FILTER=benchmark`ë¡œ Spark ì‘ì—…

**ìˆ˜í–‰ ì‘ì—…**:
1. ë²¤ì¹˜ë§ˆí¬ ETF ë°ì´í„° ê°€ìš©ì„± í™•ì¸ (4/6 ì„ê³„ê°’)
2. ë‹¤ìŒì— ëŒ€í•œ Top 5 holdings ê³„ì‚° Spark ì‘ì—… ì‹¤í–‰:
   - 5ì¼ ìœˆë„ìš°
   - 10ì¼ ìœˆë„ìš°
   - 20ì¼ ìœˆë„ìš° (ì›”ê°„)
3. ê²°ê³¼ë¥¼ `analytics_etf_top_holdings`ì— ì €ì¥
4. **1íšŒ ì‹¤í–‰ í›„ ì •ì§€**

### ê·¸ë£¹ 4: ì„¹í„° Top Holdings ë¶„ì„
**DAG**: `daily_sector_top_holdings_dag.py`  
**ìŠ¤ì¼€ì¤„**: `0 12 * * 1-5` (ì›”-ê¸ˆ ì˜¤í›„ 12ì‹œ UTC)  
**ì‹¤í–‰**: **í•˜ë£¨ 1íšŒ** (ìŠ¤ì¼€ì¤„ ë°°ì¹˜)  
**ì¢…ì†ì„±**: ê·¸ë£¹ 2 ë°ì´í„° í•„ìš” (ìµœì†Œ 8/11ê°œ ETF)  
**ì²˜ë¦¬**: `ETF_TYPE_FILTER=sector`ë¡œ Spark ì‘ì—…

**ìˆ˜í–‰ ì‘ì—…**:
1. ì„¹í„° ETF ë°ì´í„° ê°€ìš©ì„± í™•ì¸ (8/11 ì„ê³„ê°’)
2. ë‹¤ìŒì— ëŒ€í•œ Top 5 holdings ê³„ì‚° Spark ì‘ì—… ì‹¤í–‰:
   - 5ì¼ ìœˆë„ìš°
   - 10ì¼ ìœˆë„ìš°
   - 20ì¼ ìœˆë„ìš° (ì›”ê°„)
3. ê²°ê³¼ë¥¼ `analytics_etf_top_holdings`ì— ì €ì¥
4. **1íšŒ ì‹¤í–‰ í›„ ì •ì§€**

### ì›”ê°„ ìˆ˜ì§‘: ë§ˆì§€ë§‰ ì£¼ë§ ë°°ì¹˜
**DAG**: `monthly_etf_collection_last_weekend_dag.py`  
**ìŠ¤ì¼€ì¤„**: `0 8 * * 6` (ë§¤ì£¼ í† ìš”ì¼ ì˜¤ì „ 8ì‹œ UTC, ë§ˆì§€ë§‰ ì£¼ë§ë¡œ í•„í„°ë§)  
**ì‹¤í–‰**: **ì›” 1íšŒ** (ìŠ¤ì¼€ì¤„ ë°°ì¹˜)  
**í‹°ì»¤**: ì „ì²´ 17ê°œ ETF (ë²¤ì¹˜ë§ˆí¬ 6ê°œ + ì„¹í„° 11ê°œ)  
**Rate Limit**: í‹°ì»¤ ê°„ 8ì´ˆ (ì•ˆì „ì„ ìœ„í•´ ë” ì—„ê²©)  
**ì´ ì†Œìš” ì‹œê°„**: ~2.5ë¶„

**ìˆ˜í–‰ ì‘ì—…**:
1. í˜„ì¬ ë‚ ì§œê°€ ì›”ì˜ ë§ˆì§€ë§‰ ì£¼ë§ì¸ì§€ í™•ì¸ (day > last_day - 7 AND weekday in [5, 6])
2. ëª¨ë“  ETFì˜ ìµœê·¼ 5ê±°ë˜ì¼ ìˆ˜ì§‘
3. í¬ê´„ì ì¸ Top Holdings ë¶„ì„ ì‹¤í–‰ (í•„í„°ë§ ì—†ìŒ)
4. í‰ì¼ ì‹œì¥ ê°œì¥ì¼ ê°„ì„­ ì—†ì´ ì›”ê°„ ë°ì´í„° ìŠ¤ëƒ…ìƒ· ë³´ì¥
5. **1íšŒ ì‹¤í–‰ í›„ ì •ì§€**

**ì™œ ë§ˆì§€ë§‰ ì£¼ë§?**:
- í‰ì¼ ì‹œì¥ ê°œì¥ì¼ í”¼í•¨ (API íŠ¸ë˜í”½ ë‚®ìŒ)
- í† ìš”ì¼/ì¼ìš”ì¼ì€ ì¼ë°˜ì ìœ¼ë¡œ yfinance ì‚¬ìš©ëŸ‰ ìµœì†Œ
- ë‹¤ìŒ ì£¼ ì¼ë³„ ìˆ˜ì§‘ ì‹œì‘ ì „ ë²„í¼ ì œê³µ

## í‰ì¼ í•„í„°ë§ ë¡œì§

ëª¨ë“  ì¼ë³„ DAGëŠ” í‰ì¼ í™•ì¸ êµ¬í˜„:

```python
def is_weekday(**context):
    """ì‹¤í–‰ ë‚ ì§œê°€ í‰ì¼(ì›”-ê¸ˆ)ì¸ì§€ í™•ì¸"""
    execution_date = context['execution_date']
    weekday = execution_date.weekday()  # 0=ì›”, 6=ì¼
    if weekday >= 5:  # í† ìš”ì¼ ë˜ëŠ” ì¼ìš”ì¼
        raise ValueError(f"Skipping execution on {execution_date.strftime('%A')}")
    return True
```

## ì›”ê°„ ë§ˆì§€ë§‰ ì£¼ë§ ë¡œì§

```python
from calendar import monthrange

def is_last_weekend(**context):
    """ì‹¤í–‰ ë‚ ì§œê°€ ì›”ì˜ ë§ˆì§€ë§‰ ì£¼ë§ì¸ì§€ í™•ì¸"""
    execution_date = context['execution_date']
    year = execution_date.year
    month = execution_date.month
    day = execution_date.day
    weekday = execution_date.weekday()
    
    # ì›”ì˜ ë§ˆì§€ë§‰ ë‚  ê°€ì ¸ì˜¤ê¸°
    last_day = monthrange(year, month)[1]
    
    # ë§ˆì§€ë§‰ 7ì¼ ì´ë‚´ì´ê³  ì£¼ë§(í† =5, ì¼=6)ì¸ì§€ í™•ì¸
    if day > (last_day - 7) and weekday in [5, 6]:
        return True
    
    raise ValueError("Not the last weekend of the month")
```

## ë°ì´í„° ì¤€ë¹„ ìƒíƒœ í™•ì¸

ê·¸ë£¹ 3ê³¼ 4ëŠ” Spark ì‘ì—… ì‹¤í–‰ ì „ ì†ŒìŠ¤ ë°ì´í„° ê°€ìš©ì„± í™•ì¸:

### ë²¤ì¹˜ë§ˆí¬ ë°ì´í„° í™•ì¸ (ê·¸ë£¹ 3)
- í•„ìš”: 6ê°œ ë²¤ì¹˜ë§ˆí¬ ETF ì¤‘ 4ê°œ
- ì„ê³„ê°’: 66% ë°ì´í„° ê°€ìš©ì„±
- ê·¼ê±°: ì¼ë¶€ ETF ì‹¤íŒ¨í•´ë„ ë¶„ì„ ì§„í–‰ ê°€ëŠ¥

### ì„¹í„° ë°ì´í„° í™•ì¸ (ê·¸ë£¹ 4)
- í•„ìš”: 11ê°œ ì„¹í„° ETF ì¤‘ 8ê°œ
- ì„ê³„ê°’: 73% ë°ì´í„° ê°€ìš©ì„±
- ê·¼ê±°: ì„¹í„° ë¶„ì„ì´ ëŒ€ë‹¤ìˆ˜ ì»¤ë²„ë¦¬ì§€ë¡œ ë” ê²¬ê³ í•¨

## ì‹œê°„ëŒ€ ê³ ë ¤ì‚¬í•­

- **ëª¨ë“  ìŠ¤ì¼€ì¤„ì€ UTC** (í˜‘ì • ì„¸ê³„ì‹œ)
- **í˜„ì§€ ì‹œê°„ëŒ€ë¡œ ë³€í™˜**:
  - EST (ë‰´ìš•): UTC - 5ì‹œê°„
  - PST (ë¡œìŠ¤ì•¤ì ¤ë ˆìŠ¤): UTC - 8ì‹œê°„
  - KST (í•œêµ­): UTC + 9ì‹œê°„
  - ì˜ˆ: ì˜¤ì „ 9ì‹œ UTC = ì˜¤ì „ 4ì‹œ EST = ì˜¤ì „ 1ì‹œ PST = ì˜¤í›„ 6ì‹œ KST

### ë‹¤ë¥¸ ì‹œê°„ëŒ€ì˜ ì¼ë³„ ìŠ¤ì¼€ì¤„

| UTC ì‹œê°„ | EST ì‹œê°„ | PST ì‹œê°„ | KST ì‹œê°„ | ê·¸ë£¹ |
|----------|----------|----------|----------|-------|
| 09:00    | 04:00    | 01:00    | 18:00    | ë²¤ì¹˜ë§ˆí¬ ETF ë°ì´í„° |
| 10:00    | 05:00    | 02:00    | 19:00    | ì„¹í„° ETF ë°ì´í„° |
| 11:00    | 06:00    | 03:00    | 20:00    | ë²¤ì¹˜ë§ˆí¬ Holdings |
| 12:00    | 07:00    | 04:00    | 21:00    | ì„¹í„° Holdings |

## Rate Limiting ì„¸ë¶€ì‚¬í•­

### ì¼ë³„ ìˆ˜ì§‘ (ê·¸ë£¹ 1-2)
```python
for ticker in tickers:
    data = yf.download(ticker, ...)
    time.sleep(5)  # 5ì´ˆ ì§€ì—°
```
- **ë¹„ìœ¨**: ë¶„ë‹¹ 12ê°œ í‹°ì»¤
- **ì•ˆì „ ì—¬ìœ **: ë²„ìŠ¤íŠ¸ í”¼í•˜ê¸° ìœ„í•´ ë³´ìˆ˜ì 

### ì›”ê°„ ìˆ˜ì§‘
```python
for ticker in all_tickers:
    data = yf.download(ticker, ...)
    time.sleep(8)  # 8ì´ˆ ì§€ì—° (ë” ì—„ê²©)
```
- **ë¹„ìœ¨**: ë¶„ë‹¹ 7.5ê°œ í‹°ì»¤
- **ê·¼ê±°**: ë°°ì¹˜ ìˆ˜ì§‘ì„ ìœ„í•œ ì¶”ê°€ ì•ˆì „

## DAG ì¢…ì†ì„±

```
ê·¸ë£¹ 1 (ë²¤ì¹˜ë§ˆí¬ ë°ì´í„°)
   â””â”€â†’ ê·¸ë£¹ 3 (ë²¤ì¹˜ë§ˆí¬ Holdings) [2ì‹œê°„ ì§€ì—°]

ê·¸ë£¹ 2 (ì„¹í„° ë°ì´í„°)
   â””â”€â†’ ê·¸ë£¹ 4 (ì„¹í„° Holdings) [2ì‹œê°„ ì§€ì—°]
```

**êµì°¨ ì¢…ì†ì„± ì—†ìŒ**: ë²¤ì¹˜ë§ˆí¬ì™€ ì„¹í„° íŒŒì´í”„ë¼ì¸ì€ ë…ë¦½ì 

## ëª¨ë‹ˆí„°ë§ ë° íŠ¸ëŸ¬ë¸”ìŠˆíŒ…

### DAG ìƒíƒœ í™•ì¸
```bash
docker compose exec airflow airflow dags list | grep daily
docker compose exec airflow airflow dags list | grep monthly
```

### ë‹¤ìŒ ì‹¤í–‰ ì‹œê°„ ë³´ê¸°
```bash
docker compose exec airflow airflow dags show daily_benchmark_etf_collection
```

### DAG í™œì„±í™”/ë¹„í™œì„±í™”
```bash
# í™œì„±í™”
docker compose exec airflow airflow dags unpause daily_benchmark_etf_collection

# ë¹„í™œì„±í™”
docker compose exec airflow airflow dags pause daily_benchmark_etf_collection
```

### ì‹¤í–‰ ë¡œê·¸ ëª¨ë‹ˆí„°ë§
```bash
docker compose logs -f airflow
```

### ì¼ë°˜ì ì¸ ë¬¸ì œ

**ë¬¸ì œ**: DAGê°€ ì£¼ë§ì— ì‹¤í–‰ë¨  
**í•´ê²°ì±…**: DAG ì½”ë“œì˜ `is_weekday()` í•¨ìˆ˜ í™•ì¸

**ë¬¸ì œ**: ì›”ê°„ ìˆ˜ì§‘ì´ ë§¤ì£¼ í† ìš”ì¼ë§ˆë‹¤ ì‹¤í–‰ë¨  
**í•´ê²°ì±…**: `calendar.monthrange()`ë¡œ `is_last_weekend()` ë¡œì§ í™•ì¸

**ë¬¸ì œ**: Rate Limit ì—ëŸ¬ (429)  
**í•´ê²°ì±…**: í‹°ì»¤ ê°„ ì§€ì—° ì¦ê°€ (5ì´ˆ â†’ 8ì´ˆ ì´ìƒ)

**ë¬¸ì œ**: ë°ì´í„° ëˆ„ë½ìœ¼ë¡œ ê·¸ë£¹ 3/4 ê±´ë„ˆëœ€  
**í•´ê²°ì±…**: ê·¸ë£¹ 1/2 ì‹¤í–‰ ì„±ê³µ í™•ì¸, ì„ê³„ê°’ ê²€í†  (4/6 ë˜ëŠ” 8/11)

## í…ŒìŠ¤íŠ¸ ì „ëµ

### ê°œë³„ DAG í…ŒìŠ¤íŠ¸
```bash
docker compose exec airflow airflow dags test daily_benchmark_etf_collection 2024-01-15
```

### í‰ì¼ ë¡œì§ í…ŒìŠ¤íŠ¸
```bash
# ì„±ê³µí•´ì•¼ í•¨ (ì›”ìš”ì¼)
airflow dags test daily_benchmark_etf_collection 2024-01-15

# ValueErrorë¡œ ì‹¤íŒ¨í•´ì•¼ í•¨ (ì¼ìš”ì¼)
airflow dags test daily_benchmark_etf_collection 2024-01-14
```

### ì›”ê°„ ë¡œì§ í…ŒìŠ¤íŠ¸
```bash
# ì„±ê³µí•´ì•¼ í•¨ (1ì›” ë§ˆì§€ë§‰ í† ìš”ì¼)
airflow dags test monthly_etf_collection_last_weekend 2024-01-27

# ì‹¤íŒ¨í•´ì•¼ í•¨ (ì²« ë²ˆì§¸ í† ìš”ì¼)
airflow dags test monthly_etf_collection_last_weekend 2024-01-06
```

## ë°°í¬ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] `airflow/dags/`ì— 5ê°œ DAG íŒŒì¼ ëª¨ë‘ ìˆëŠ”ì§€ í™•ì¸
- [ ] Spark ì‘ì—…ì´ `ETF_TYPE_FILTER` í™˜ê²½ ë³€ìˆ˜ ì§€ì›í•˜ëŠ”ì§€ í™•ì¸
- [ ] í‰ì¼ í•„í„°ë§ ë¡œì§ í…ŒìŠ¤íŠ¸
- [ ] ì›”ê°„ ë§ˆì§€ë§‰ ì£¼ë§ ë¡œì§ í…ŒìŠ¤íŠ¸
- [ ] ìƒˆ DAG í™œì„±í™”:
  - `daily_benchmark_etf_collection`
  - `daily_sector_etf_collection`
  - `daily_benchmark_top_holdings`
  - `daily_sector_top_holdings`
  - `monthly_etf_collection_last_weekend`
- [ ] ì´ì „ ì¶©ëŒ DAG ë¹„í™œì„±í™”/ì¤‘ë‹¨:
  - `benchmark_data_daily_dag` (ì¡´ì¬í•˜ëŠ” ê²½ìš°)
  - `etf_top_holdings_analysis_dag` (ì´ì „ ì¼ë³„ ë²„ì „)
- [ ] ê° DAGì˜ ì²« ì‹¤í–‰ ëª¨ë‹ˆí„°ë§
- [ ] `analytics_etf_top_holdings` í…Œì´ë¸”ì˜ ë°ì´í„° í™•ì¸
- [ ] íŒ€ì„ ìœ„í•œ ì‹œê°„ëŒ€ ë³€í™˜ ë¬¸ì„œí™”

## ì„±ëŠ¥ ë©”íŠ¸ë¦­

### ì˜ˆìƒ ì¼ë³„ ì‹¤í–‰ ì‹œê°„
- ê·¸ë£¹ 1: ~30ì´ˆ (6ê°œ ETF Ã— 5ì´ˆ)
- ê·¸ë£¹ 2: ~55ì´ˆ (11ê°œ ETF Ã— 5ì´ˆ)
- ê·¸ë£¹ 3: ~5-10ë¶„ (Spark ì‘ì—…)
- ê·¸ë£¹ 4: ~5-10ë¶„ (Spark ì‘ì—…)
- **ì´**: 4ì‹œê°„ì— ê±¸ì³ ~20-30ë¶„

### ì˜ˆìƒ ì›”ê°„ ì‹¤í–‰ ì‹œê°„
- ë°ì´í„° ìˆ˜ì§‘: ~2.5ë¶„ (17ê°œ ETF Ã— 8ì´ˆ)
- ë¶„ì„: ~10-15ë¶„ (ëª¨ë“  ETFì˜ Spark ì‘ì—…)
- **ì´**: ~15-20ë¶„

## í–¥í›„ ìµœì í™”

1. **ë™ì  Rate Limiting**: API ì‘ë‹µ ì‹œê°„ì— ë”°ë¼ ì§€ì—° ì¡°ì •
2. **ë³‘ë ¬ Spark ì‘ì—…**: ê·¸ë£¹ 3 & 4 ë™ì‹œ ì‹¤í–‰ (í…ŒìŠ¤íŠ¸ í•„ìš”)
3. **ì¬ì‹œë„ ë¡œì§**: ì‹¤íŒ¨í•œ í‹°ì»¤ ê°€ì ¸ì˜¤ê¸°ì— ì§€ìˆ˜ ë°±ì˜¤í”„ êµ¬í˜„
4. **ì•Œë¦¼**: ì‹¤íŒ¨ ì‹œ Slack/ì´ë©”ì¼ ì•Œë¦¼ ì¶”ê°€
5. **ë©”íŠ¸ë¦­ ëŒ€ì‹œë³´ë“œ**: ì„±ê³µë¥ , ì‹¤í–‰ ì‹œê°„, API ì—ëŸ¬ ì¶”ì 

## ì°¸ì¡°

- [Airflow Cron êµ¬ë¬¸](https://airflow.apache.org/docs/apache-airflow/stable/core-concepts/dags.html#cron)
- [yfinance ë¬¸ì„œ](https://pypi.org/project/yfinance/)
- [Python calendar.monthrange](https://docs.python.org/3/library/calendar.html#calendar.monthrange)

````